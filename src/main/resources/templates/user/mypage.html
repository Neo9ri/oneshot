<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마이페이지</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
    <script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js"></script>   
    <link rel="icon" href="../img/favicon-32x32.png" type="image/x-icon" th:href="@{/img/favicon-32x32.png}" />
    <link rel="stylesheet" href="../css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}"/>
    <link rel="stylesheet" href="../css/main_style.css" th:href="@{/css/main_style.css}"/>
    <link rel="stylesheet" href="../css/mypage.css" th:href="@{/css/mypage.css}"/>
</head>
<body>
    <!-- order Modal -->
    <div class="modal fade" id="order_modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h1 class="modal-title fs-5" id="order_modal_head_title">문의 내역</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <table class="order_modal_table">
                        <thead>
                        <tr>
                            <th>상품명</th>
                            <th>상품금액</th>
                            <th>수량</th>
                        </tr>
                        </thead>
                        <tbody id="order_modal_table_body">
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>
    <!--inquiry Modal-->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">문의 내역</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="exampleFormControlInput1" class="form-label">제목</label>
                        <input type="email" class="form-control" id="exampleFormControlInput1" placeholder="제목" disabled readonly>
                    </div>
                    <div class="mb-3">
                        <label for="exampleFormControlTextarea1" class="form-label">문의 내용</label>
                        <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" disabled readonly></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="exampleFormControlTextarea1" class="form-label">답변</label>
                        <textarea class="form-control" id="exampleFormControlTextarea2" rows="3" disabled readonly></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>
    <div id="up" onclick="scrollToTop()"><span class="blind">스크롤 올리기</span></div>
    <!-- header 시작 -->
    <header th:replace="~{/fragment/defaultHeader :: #header}">
    </header>
    <!-- header 종료 -->
    <!-- mypage 시작 -->
    <div class="mypage_container">
        <h1>마이 원샷</h1>
        <div class="mypage_user">
            <div class="mypage_user_icon">
                유저 아이콘 이미지
            </div>
            <div class="mypage_user_text">
                <h3>홍길동</h3>
                <div>
                    <p>hong123@naver.com</p>
                </div>
                <div>
                    <a href="#">비밀번호 변경</a>
                </div>
                <div>
                    <a href="#">문의 내역</a>
                </div>
            </div>
        </div>
        <div class="mypage_user_interface">
            <table>
                <tr>
                    <td class="user_icon_img">유저 아이콘 이미지</td>
                    <td class="user_content">홍길동</td>
                </tr>
                <tr>
                    <td class="phone_icon_img">
                        <span>
                            전화 아이콘 이미지
                        </span>
                    </td>
                    <td class="user_content">010-1111-1111</td>
                </tr>
                <tr>
                    <td class="email_icon_img">
                        <span>이메일 아이콘 이미지</span>
                    </td>
                    <td class="user_content">hong123@naver.com</td>
                </tr>
                <tr>
                    <td class="home_icon_img">
                        <sapn>
                            집 주소 아이콘 이미지
                        </sapn>
                    </td>
                    <td class="user_content_last">서울특별시 강남구 신사동</td>
                </tr>
            </table>
            <div class="mypage_button">
                <button class="mypage_add_button">수정하기</button>
                <div class="mypage_button_hidden">
                    <button class="mypage_cancle_button">취소</button>
                    <button class="mypage_check_button">확인</button>
                </div>
            </div>
        </div>
        <hr>
        <div class="mypage_order_search">
            <h2>주문/배송 조회</h2>
            <table>
                <thead>
                    <tr>
                        <th>주문번호</th>
                        <th>주문일</th>
                        <th>상품금액/배송비</th>
                        <th>총 상품금액</th>
                        <th>주문상태</th>
                        <th>내용보기</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="purchase:${purchaseList}">
                        <td th:text="${purchase.id}" ></td>
                        <td th:text="${purchase.date_created}"></td>
                        <td th:text="${purchase.total_price+'/3000'}"></td>
                        <td th:text="${purchase.total_price+3000}"></td>
                        <td th:text="${purchase.status}"></td>
                        <td>
                            <!-- Button trigger modal -->
                            <button type="button" class="btn btn_order_primary" data-bs-toggle="modal" data-bs-target="#order_modal" th:data-purchase-id="${purchase.id}">
                                내용보기
                            </button>
                        </td>
                    </tr>
<!--                    <tr>-->
<!--                        <td>2</td>-->
<!--                        <td>170723-521507-11</td>-->
<!--                        <td>2023-05-27</td>-->
<!--                        <td>46,000/3000</td>-->
<!--                        <td>49,000</td>-->
<!--                        <td>배송준비</td>-->
<!--                    </tr>-->
                </tbody>
            </table>
        </div>
        <div class="d-flex justify-content-center py-5">
            <nav aria-label="">
                <ul class="pagination">
                    <li th:if="${pagination.existPreviousLastPage}" class="page-item">
                        <a href="#" class="page-link" th:href="@{mypage(page=${pagination.previousLastPage})} + ${'#table'}">&lt;</a>
                    </li>
                    <li th:each="page : ${#numbers.sequence(pagination.firstPage,pagination.lastPage)}">
                        <a class="page-link" th:class="${page == pagination.requestPage}? 'page-link active': 'page-link'" href="#" th:href="@{mypage(page=${page})} + ${'#table'}" th:text="${page}">1</a>
                    </li>
                    <li th:if="${pagination.existNextFirstPage}" class="page-item">
                        <a href="#" class="page-link" th:href="@{mypage(page=${pagination.nextFirstPage})} + ${'#table'}" >&gt;</a>
                    </li>
                </ul>
            </nav>
        </div>
        <hr>
        <div class="mypage_inquiry_search">
            <h2>문의 내역</h2>
            <table>
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>문의 날짜</th>
                        <th>문의 종류</th>
                        <th>제목</th>
                        <th>상태</th>
                        <th>내용보기</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>2023-05-31</td>
                        <td>배송문의</td>
                        <td>안동소주 배송날짜...</td>
                        <td>답변완료</td>
                        <td>
                            <!-- Button trigger modal -->
                            <button type="button" class="btn btn_primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                                내용보기
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>2023-05-27</td>
                        <td>상품 문의</td>
                        <td>안동소주 박스 길이...</td>
                        <td>답변대기</td>
                        <td>
                            <!-- Button trigger modal -->
                            <button type="button" class="btn btn_primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                                내용보기
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="mypage_inquiry_pageMove">
                <ul>
                    <li>
                        <a href="#">&lt;</a>
                    </li>
                    <li>
                        <a href="#">1</a>
                    </li>
                    <li>
                        <a href="#">2</a>
                    </li>
                    <li>
                        <a href="#">3</a>
                    </li>
                    <li>
                        <a href="#">4</a>
                    </li>
                    <li>
                        <a href="#">5</a>
                    </li>
                    <li>
                        <a href="#">&gt;</a>
                    </li>
                </ul>
            </div>
        </div>
        <hr>
    </div>
    <!-- mypage 종료 -->
    <!-- footer : START -->
    <footer>
        <div class="center">
            <div class="left_wrap">
                <p class="btm_logo"><img src="../img/oneshot_logo_bw.png" alt="원샷 - 우리술 한잔,"></p>
                <div class="text_wrap">
                    <p>원샷 - 우리술 한잔,</p>
                    <address>서울시 서대문구 연세로 8-1</address>
                    <nav>
                        <ul>
                            <li><a href="">전통주 이야기</a></li>
                            <li><a href="">지역별 전통주</a></li>
                            <li><a href="">주종별 전통주</a></li>
                            <li><a href="">가격별 전통주</a></li>
                        </ul>
                    </nav>
                    <div class="info">
                        <p>대표 : 홍길동</p>
                        <p>사업자 등록번호 : 100-11-111111</p>
                        <p>개인정보관리자 : 홍길동</p>
                    </div>
                    <div class="contact_info">
                        <p>대표번호 : 02-1234-1234</p>
                        <p>메일 : oneshot@oneshot.com</p>
                    </div>
                    <div>Copyrights&copy; oneshot All Rights Reserved.</div>
                </div>
            </div>
            <div class="cs">
                <dl>
                    <dt>CS CENTER</dt>
                    <dd>070-1234-1234</dd>
                    <dd>평일 : 09:00 ~ 18:00<br>
                        점심 시간 : 12:00 ~ 13:00<br>
                        주말 밋 공휴일 제외
                    </dd>
                </dl>
            </div>
            <div class="social">
                <h4>SOCIAL MEDIA</h4>
                <p>Follow @oneshot</p>
                <ul>
                    <li><a href="#"><img src="../img/instagram_footer.svg" alt="인스타그램"></a></li>
                    <li><a href="#"><img src="../img/youtube_footer.svg" alt="유투브"></a></li>
                    <li><a href="#"><img src="../img/facebook_footer.svg" alt="페이스북"></a></li>
                </ul>
            </div>
        </div>
    </footer>
    <!-- footer : END -->
    <script>
   $(document).ready(function() {
      $('.btn_order_primary').click(function() {
        var purchaseId = $(this).data('purchase-id');

        $.ajax({
          type: 'POST',
          url: '/purchaseDetail',
          data: { purchaseId: purchaseId },
          success: function(response) {
            // Ajax 요청이 성공하면 처리할 코드를 작성합니다.
            console.log(response);

            // 모달 창을 엽니다.
            $('#order_modal').modal('show');

            // 모달 내부의 테이블 body를 찾습니다.
            var modalTableBody = $('#order_modal_table_body');

            // 기존 내용을 비웁니다.
            modalTableBody.empty();

            // 구매 상세 정보를 테이블에 추가합니다.
            for (var i = 0; i < response.length; i++) {
              var detail = response[i];
              var row = '<tr>' +
                '<td>' + detail.productName + '</td>' +
                '<td>' + detail.price + '</td>' +
                '<td>' + detail.quantity + '</td>' +
                '</tr>';
              modalTableBody.append(row);
            }
          },
          error: function(xhr, status, error) {
            // Ajax 요청이 실패한 경우 처리할 코드를 작성합니다.
            console.log(error);
          }
        });
      });
    });
    </script>
    <script src="/js/header.js"></script>
</body>
</html>